let is_comparePage=!1;jQuery(document).ready(function(e){e("#loading-overlay").fadeOut(500),e(document).on("click",'a[href="#"]',function(e){e.preventDefault()});const t=e("#scroll-to-top");window.onscroll=function(){document.body.scrollTop>100||document.documentElement.scrollTop>100?t.fadeIn():t.fadeOut()},t.click(function(){window.scrollTo({top:0,behavior:"smooth"})});new Swiper(".banner-footer .swiper",{loop:!0,slidesPerView:4,spaceBetween:0,pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{320:{slidesPerView:1,spaceBetween:0},480:{slidesPerView:2,spaceBetween:0},640:{slidesPerView:3,spaceBetween:0},992:{slidesPerView:4,spaceBetween:0}}});var a,o,n;e("#new-product-filter2").initSwiperWithFilter(),e(".category-filter-scroll").on("wheel",function(e){0!==e.originalEvent.deltaY&&(e.preventDefault(),this.scrollLeft+=e.originalEvent.deltaY)}),e(".filterable-list").filterableList(),a=JSON.parse(localStorage.getItem("viewedProducts"))||[],o=e("#viewed-products"),n=1,o.length&&(o.empty(),a.forEach(function(e){if(n<=5){let t=`<div class="viewed-item" data-product-info="">\n                           <div class="product-image">\n                               <a href="${e.url}" class="product-url"><img src="${e.image}" alt="${e.name}"></a>\n                           </div>\n                           <div class="product-content">\n                               <h5 class="title"><a href="${e.url}" class="product-url">${e.name}</a></h5>\n                               <p class="price">${e.price}</p>\n                           </div>\n                           <a class="btn text-black-50 remove-viewed-btn" role="button" href="#" data-product-id="${e.id}"><i class="bi bi-x-circle-fill"></i></a>\n                       </div>`;o.append(t),n++}}));let i=JSON.parse(localStorage.getItem("compareList"))||[];updateCompareListUI(i,!0),e(".photo-box").on("wheel",function(t){if(0!==t.originalEvent.deltaY){t.preventDefault();let a=e(this).find(".photo-box-item").first().outerWidth(!0);t.originalEvent.deltaY>0?this.scrollTo({left:this.scrollLeft+a,behavior:"smooth"}):this.scrollTo({left:this.scrollLeft-a,behavior:"smooth"})}}),e(document).on("click","#viewed-products .remove-viewed-btn",function(t){let a=e(this).closest(".viewed-item");t.preventDefault();let o=e(this).data("product-id");return o&&(a.fadeOut(),function(e){let t=JSON.parse(localStorage.getItem("viewedProducts"))||[];t=t.filter(function(t){return t.id!==e}),localStorage.setItem("viewedProducts",JSON.stringify(t))}(o)),!1}),e(document).on("click","a.product-url",function(e){}),e(".flashSale-wrapper").length>0&&function(t){let a=e(t),o=a.data("enddate");const n=a.find(".day"),i=a.find(".hour"),s=a.find(".minute"),r=a.find(".second"),c=new Date(o);function l(){const e=new Date,t=c-e;if(t<=0)return void clearInterval(d);const a=Math.floor(t/864e5),o=Math.floor(t%864e5/36e5),l=Math.floor(t%36e5/6e4),u=Math.floor(t%6e4/1e3);n.text(a.toString().padStart(2,"0")),i.text(o.toString().padStart(2,"0")),s.text(l.toString().padStart(2,"0")),r.text(u.toString().padStart(2,"0"))}const d=setInterval(l,1e3);l()}(".box-count-down"),e("#clear-viewed-products").click(function(t){t.preventDefault(),localStorage.removeItem("viewedProducts"),e("#viewed-products").fadeOut()}),e("#openForm").on("click",function(){e("#registerForm").fadeIn()}),e("#closeForm").on("click",function(){e("#registerForm").fadeOut()});let s,r,c=!1;function l(t){let a=e("#searchProduct_modal").find(".modal-body"),o='<div id="searchProduct_grid" class="product-grid shadow-item">';e.ajax({url:ThemeVars.ajaxurl,type:"POST",data:{action:"compare_list_search",nonce:ThemeVars.nonce,search:t},beforeSend:function(){a.html('<div class="d-flex justify-content-center w-100">\n                    <div class="spinner-border" role="status">\n                        <span class="visually-hidden">Loading...</span>\n                    </div>\n                </div>')},success:function(e){if(e.success){let t=JSON.parse(localStorage.getItem("compareList"))||[];e.data.forEach(function(e){let a=t.some(t=>t.sku===e.sku)?`<i class="bi bi-check2-circle"></i> ${translations.added}`:`<i class="bi bi-plus-circle"></i> ${translations.compare}`,n=`\n                            <div class="product-item  product-data flex-column" ${e.meta_info}>\n                                ${e.discount}\n                                ${e.badge}\n                                <div class="image">\n                                    <a href="${e.url}" class="product-url">\n                                        <img src="${e.image_url}" data-bs-toggle="tooltip" title="" loading="lazy">\n                                    </a>\n                                </div>\n                                <div class="text-badge">${e.text_badge}</div>\n                                <div class="content">\n                                    <h5 class="title" data-bs-toggle="tooltip" title="">\n                                        <a href="${e.url}" class="product-url">${e.title}</a>\n                                    </h5>\n                                    <div class="product-meta-text sku">${e.sku}</div>\n                                    <div class="price">${e.htmlPrice}</div>\n                                </div>\n                                <div class="buttons">\n                                    <a href="#" role="button" class="btn search-compare text-primary fw-bold compare-btn" onclick="addToCompare(this)" data-id="${e.sku}">\n                                        ${a}\n                                    </a>\n                                </div>\n                            </div>`;o+=n}),a.html(o+"</div>")}else a.html('<p class="text-center text-danger">Không tìm thấy sản phẩm.</p>')}})}e(document).on("click",".favourite-btn",function(t){if(t.preventDefault(),c)return;var a=e(this).data("product-id");let o=e(this);c=!0,e.ajax({url:ThemeVars.ajaxurl,type:"POST",data:{action:"add_to_wishlist",nonce:ThemeVars.nonce,product_id:a},beforeSend:function(){toggleButtonState(o),o.text("...")},success:function(e){e.success?o.text(e.data.count_text):siteNotify(e.data.message)},error:function(){},complete:function(){setTimeout(()=>{c=!1,toggleButtonState(o,!1)},3e3)}})}),e(document).on("click",".remove-favorite-btn",function(t){t.preventDefault();var a=e(this).data("product-id");let o=e(this),n=e(this).closest(".product-item");e.ajax({url:ThemeVars.ajaxurl,type:"POST",data:{action:"remove_wishlist",nonce:ThemeVars.nonce,product_id:a},beforeSend:function(){toggleButtonState(o)},success:function(e){e.success&&(console.log(n),n.remove())}})}),e("#searchProduct_modal").on("show.bs.modal",function(t){l(e("#searchProduct_compare_input").val().trim())}),e("#searchProduct_compare_input").on("keyup",function(){let t=e(this).val().trim();clearTimeout(s),s=setTimeout(()=>{(0===t.length||t.length>=3)&&l(t)},500)}),e("#searchProduct_modal").on("hide.bs.modal",function(e){let t=JSON.parse(localStorage.getItem("compareList"))||[];"function"==typeof updateCompareListUI_page&&updateCompareListUI_page(t),updateCompareListUI(t)}),updateCompareButtonStatus();const d=e("#searchInput"),u=e("#searchResultsContainer");function p(t){e.ajax({url:ThemeVars.ajaxurl,type:"POST",data:{action:"live_search",search_query:t,nonce:ThemeVars.nonce},beforeSend:function(){e("#searchBtn-spinner").show(),e("#searchBtn i").css("opacity",0)},success:function(t){t.success?function(t){if(u.empty(),t&&t.length>0){const a=e('<ul class="list-group list-group-flush"></ul>');t.forEach(function(e){let t="product"==e.type?`<div class="d-flex gap-1 search-price" >${e.price}</div>`:`<div class="text-secondary">${e.type}</div>`;const o=`\n                    <li class="list-group-item list-group-item-action">\n                        <a href="${e.url}" data-url="${e.url}" class="d-flex align-items-center text-decoration-none search-result-item">\n                            ${e.thumbnail?`<img src="${e.thumbnail}" alt="" width="40" height="40" class="me-2 object-fit-contain">`:""}\n                            <div class="flex-grow-1">\n                                <div class="fw-bold text-dark">${e.title}</div>\n                                ${t}\n                            </div>\n                        </a>\n                    </li>\n                `;a.append(o)}),u.append(a).show()}else u.html('<div class="p-2 text-center text-muted small">Không tìm thấy kết quả nào.</div>').show()}(t.data):u.html('<div class="p-2 text-center text-danger small">'+(t.data||"Có lỗi xảy ra.")+"</div>").show(),e("#searchBtn-spinner").hide(),e("#searchBtn i").css("opacity",1)},error:function(e,t,a){console.error("Search AJAX error:",t,a),u.html('<div class="p-2 text-center text-danger small">Lỗi kết nối. Vui lòng thử lại.</div>').show()}})}function m(e){if(!e.length)return;const t=e.closest("#searchResultsContainer")[0],a=e[0],o=t.scrollTop,n=o+t.clientHeight,i=a.offsetTop,s=i+a.offsetHeight;i<o?t.scrollTop=i:s>n&&(t.scrollTop=s-t.clientHeight)}function h(e,t,a=50,o){e.val("");let n=0;!function i(){n<=t.length?(e.val(t.substring(0,n)),n++,setTimeout(i,a)):"function"==typeof o&&o()}()}function f(e){const t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{const e=document.execCommand("copy"),t=e?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+t),e&&siteNotify("copied")}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}d.on("input",function(){const t=e(this).val().trim();clearTimeout(r),t.length>=3?(u.html('<div class="p-2 text-center text-muted small">Đang tìm kiếm...</div>').show(),r=setTimeout(function(){p(t)},500)):u.hide().empty()}),d.on("keydown",function(t){if("Enter"===t.key){t.preventDefault();const a=e(this).val().trim();a.length>=3&&(u.html('<div class="p-2 text-center text-muted small">Đang tìm kiếm...</div>').show(),clearTimeout(r),p(a))}}),e("#searchBtn").on("click",function(e){e.preventDefault();const t=d.val().trim();t.length>=3&&(u.html('<div class="p-2 text-center text-muted small">Đang tìm kiếm...</div>').show(),clearTimeout(r),p(t))}),e(document).on("click",function(t){e(t.target).closest("#searchInput, #searchResultsContainer").length||u.hide()}),u.on("mousedown",function(t){t.offsetX,e(this).width()}),u.on("click",".search-result-item",function(t){t.preventDefault();const a=e(this).data("url"),o=d.val().trim();a&&o&&e.post(ThemeVars.ajaxurl,{action:"add_search_keyword",keyword:o,nonce:ThemeVars.nonce},function(){window.location.href=a})}),d.on("keydown",function(e){const t=u.find(".list-group-item-action:visible");if(!t.length)return;let a=t.filter(".active"),o=t.index(a);if("ArrowDown"===e.key){e.preventDefault();let a=o<t.length-1?o+1:0;t.removeClass("active"),t.eq(a).addClass("active"),m(t.eq(a))}else if("ArrowUp"===e.key){e.preventDefault();let a=o>0?o-1:t.length-1;t.removeClass("active"),t.eq(a).addClass("active"),m(t.eq(a))}else"Enter"===e.key?-1!==o&&(e.preventDefault(),t.eq(o).find(".search-result-item").trigger("click")):t.removeClass("active")}),e(".quick-links").on("click",".quick-link",function(t){t.preventDefault();const a=e(this).data("keyword");a&&setTimeout(function(){h(d,a.toLowerCase(),30,function(){d.trigger("input")}),d.focus()},400)}),e(".search-tags").on("click",".quick-link-badge",function(t){t.preventDefault();const a=e(this).data("keyword");a&&d.length&&(d[0].scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(function(){h(d,a.toLowerCase(),30,function(){d.trigger("input")}),d.focus()},400),d.addClass("input-highlight"),setTimeout(function(){d.removeClass("input-highlight")},1e3))}),e(document).on("click",".shareon-link",function(t){t.preventDefault();const a=e(this).data("url")||window.location.href;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(a).then(()=>{siteNotify("copied")}).catch(e=>{console.error("Failed to copy text: ",e),f(a)}):f(a)});new Swiper(".brand-swiper",{slidesPerView:"auto",spaceBetween:16,loop:!0,speed:3500,autoplay:{delay:0,disableOnInteraction:!1,pauseOnMouseEnter:!0},freeMode:!0,freeModeMomentum:!1,grabCursor:!0,allowTouchMove:!0,breakpoints:{900:{slidesPerView:6},600:{slidesPerView:4},0:{slidesPerView:2}}});if(e("#quickCompare").click(function(e){i=JSON.parse(localStorage.getItem("compareList"))||[];let t=[];i&&i.forEach(e=>{t.push(e.sku)}),t.length>0&&(loadProductComparison(t),hideCompare())}),e(window).width()<=768){e(".menu-item-has-children > a").on("click",function(t){const a=e(this).parent();a.hasClass("submenu-open")?a.removeClass("submenu-open"):(t.preventDefault(),a.siblings().removeClass("submenu-open"),a.addClass("submenu-open"))}),e(document).on("click touchstart",function(t){e(t.target).closest(".menu-item-has-children").length||e(".menu-item-has-children").removeClass("submenu-open")})}Shareon.init()});const addCompare=`<div class="cp-item-col" ><a href="#" class="cp-plus cp-plus_new"  data-bs-toggle="modal" data-bs-target="#searchProduct_modal">\n                  <i class="bi bi-plus-lg"></i><p>${translations.add_product}</p>\n                </a></div>`;function buildComparisonTable(e){if(!e||0===e.length)return void siteNotify("Không có sản phẩm để so sánh");const t=generateComparisonTableHtml(e,getAllComparisonFields(e));jQuery("#comparison-table-container").html(t),initializeTableInteractions()}function getAllComparisonFields(e){const t=new Set,a=new Set;return e.forEach(e=>{e.attributes&&Object.keys(e.attributes).forEach(e=>{t.add(e)}),e.specifications&&Object.keys(e.specifications).forEach(e=>{a.add(e)})}),{attributes:Array.from(t),specifications:Array.from(a)}}function generateComparisonTableHtml(e,t){const a=[...e];for(;a.length<3;)a.push(null);let o='<div class="comparison-table-wrapper">';return o+='<table class="product-comparison-table" id="comparison-table">',o+="<thead>",o+='<tr class="product-header-row">',o+='<th class="field-name-header"></th>',a.forEach(e=>{o+=e?`<th class="product-header">\n                <div class="product-header-content" data-sku="${e.basic_info.item_code}">\n                    <div class="product-image">\n                        ${getProductImageHtml(e.basic_info.image_url)}\n                    </div>\n                    <div class="product-name">${escapeHtml(e.basic_info.item_name)}</div>\n                    <div class="product-code">${escapeHtml(e.basic_info.item_code)}</div>\n                    <div class="product-price">${e.basic_info.price}</div>\n                    <div class="product-brand">${escapeHtml(e.basic_info.brand??"")}</div>\n                </div>\n            </th>`:`<th class="product-header empty-header">${addCompare}</th>`}),o+="</tr>",o+="</thead>",o+="<tbody>",o+=generateBasicInfoRows(a),t.attributes.length>0&&(o+=generateAttributeRows(a,t.attributes)),t.specifications.length>0&&(o+=generateSpecificationRows(a,t.specifications)),o+="</tbody>",o+="</table>",o+="</div>",o}function generateComparisonTableHtml_old(e,t){let a='<div class="comparison-table-wrapper">';return a+='<table class="product-comparison-table" id="comparison-table">',a+="<thead>",a+='<tr class="product-header-row">',a+='<th class="field-name-header"></th>',e.forEach(e=>{a+=`<th class="product-header">\n                <div class="product-header-content" data-sku="${e.basic_info.item_code}">\n                    <div class="product-image">\n                        ${getProductImageHtml(e.basic_info.image_url)}\n                    </div>\n                    <div class="product-name">${escapeHtml(e.basic_info.item_name)}</div>\n                    <div class="product-code">${escapeHtml(e.basic_info.item_code)}</div>\n                    <div class="product-price">${e.basic_info.price}</div>\n                    <div class="product-brand">${escapeHtml(e.basic_info.brand)}</div>\n                </div>\n            </th>`}),a+="</tr>",a+="</thead>",a+="<tbody>",a+=generateBasicInfoRows(e),t.attributes.length>0&&(a+=generateAttributeRows(e,t.attributes)),t.specifications.length>0&&(a+=generateSpecificationRows(e,t.specifications)),a+="</tbody>",a+="</table>",a+="</div>",a}function generateBasicInfoRows(e){let t="";return t+='<tr class="section-header-row"><td >Thông tin cơ bản</td><td colspan="'+e.length+'"></td></tr>',t+='<tr class="comparison-row">',t+='<td class="field-name">Mô tả</td>',e.forEach(e=>{t+=e?`<td class="field-value">${e.basic_info.description||"N/A"}</td>`:'<td class="field-value"></td>'}),t+="</tr>",t+='<tr class="comparison-row">',t+='<td class="field-name">Nhóm sản phẩm</td>',e.forEach(e=>{t+=e?`<td class="field-value">${escapeHtml(e.basic_info.item_group||"N/A")}</td>`:'<td class="field-value"></td>'}),t+="</tr>",t}function generateAttributeRows(e,t){let a="";return t.length>0&&(a+='<tr class="section-header-row"><td >Thuộc tính</td><td colspan="'+e.length+'"></td></tr>',t.forEach(t=>{a+='<tr class="comparison-row">',a+=`<td class="field-name">${escapeHtml(t)}</td>`,e.forEach(e=>{if(e){const o=e.attributes&&e.attributes[t]?e.attributes[t]:[];a+=`<td class="field-value">\n                        <div class="attribute-values">\n                            ${o.map(e=>`<span class="attribute-tag">${escapeHtml(e)}</span>`).join("")}\n                        </div>\n                    </td>`}else a+='<td class="field-value"></td>'}),a+="</tr>"})),a}function generateSpecificationRows(e,t){let a="";return t.length>0&&(a+='<tr class="section-header-row"><td class="title">Thông số kỹ thuật</td><td colspan="'+e.length+'"></td></tr>',t.forEach(t=>{a+='<tr class="comparison-row">',a+=`<td class="field-name">${escapeHtml(t)}</td>`,e.forEach(e=>{if(e){const o=e.specifications&&e.specifications[t]?e.specifications[t]:"N/A";a+=`<td class="field-value">${escapeHtml(o)}</td>`}else a+='<td class="field-value"></td>'}),a+="</tr>"})),a}function getProductImageHtml(e){return e?`<img src="${escapeHtml(e)}" alt="Product Image" class="product-comparison-image">`:'<div class="no-image">Không có hình ảnh</div>'}function initializeTableInteractions(){const e=jQuery("#comparison-table"),t=jQuery(window);t.on("scroll",function(){t.scrollTop()>e.offset().top?e.addClass("sticky-header"):e.removeClass("sticky-header")}),highlightDifferences(),addRemoveProductButtons()}function highlightDifferences(){jQuery(".comparison-row").each(function(){const e=jQuery(this),t=[];e.find(".field-value").each(function(){t.push(jQuery(this).text().trim())});t.every(e=>e===t[0])||e.addClass("has-differences")})}function addRemoveProductButtons(){jQuery(".product-header").each(function(e){const t=jQuery(this);if(jQuery(".product-header").length>1){const a=jQuery('<button class="remove-product-btn" title="Xóa sản phẩm">×</button>');a.on("click",function(){removeProductFromComparison(e)}),t.find(".product-header-content").append(a)}})}function removeProductFromComparison(e){const t=e+1,a=jQuery(`.product-header:eq(${e})`).find(".product-header-content").data("sku");jQuery(`.product-header:eq(${e})`).html(addCompare),jQuery("tr").each(function(){jQuery(this).find(`td:eq(${t})`).html("")});let o=JSON.parse(localStorage.getItem("compareList"))||[];o=o.filter(e=>e.sku!==a),localStorage.setItem("compareList",JSON.stringify(o)),newTitle="So sanh san phẩm",newState=o,window.history.pushState(newState,newTitle,generateCompareUrl(o)),initializeTableInteractions()}function showLoading(){jQuery("#comparison-loading").show(),jQuery("#comparison-table-container").hide()}function hideLoading(){jQuery("#comparison-loading").hide(),jQuery("#comparison-table-container").show()}function showError(e){jQuery("#comparison-table-container").html(`\n            <div class="comparison-error">\n                <p>${e}</p>\n            </div>\n        `)}function escapeHtml(e){if("string"!=typeof e)return e;const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}function getSkusFromUrl(){let e=window.location.pathname.split("/"),t=[];if(e.length>=3&&"so-sanh"===e[1]){e[2].split(";").forEach(e=>{let a=e.split(".").pop();t.push(a)})}return t}function loadProductComparison(e){e?(showLoading(),jQuery.ajax({url:ThemeVars.ajaxurl,type:"POST",data:{action:"load_product_comparison",product_skus:e,nonce:ThemeVars.nonce},success:function(e){hideLoading(),e.success?buildComparisonTable(e.data):siteNotify("Không thể tải dữ liệu sản phẩm")},error:function(){hideLoading(),siteNotify("Lỗi kết nối, vui lòng thử lại")}})):console.error("No product SKUs provided")}function toggleButtonState(e,t=!0){const a=jQuery(e),o=a.data("button-text")||a.text();o||a.data("button-text",o);const n=t?'<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" ></span> '+o:o;a.prop("disabled",t),a.html(n)}function showLoading(){jQuery("#loading-overlay").show()}function hideLoading(){jQuery("#loading-overlay").fadeOut()}function hideCompare(){jQuery("#compare-list").fadeOut(),jQuery("#compare-popup-btn").fadeIn()}function showCompare(){jQuery("#compare-list").fadeIn(),jQuery("#compare-popup-btn").fadeOut()}let addCompare_item='            <a href="#" class="cp-plus cp-plus_new"  data-bs-toggle="modal" data-bs-target="#searchProduct_modal">\n                <i class="bi bi-plus-lg"></i><p>${translations.add_product}</p></a>\n';function removeCompare_old(e){jQuery('li[data-sku="'+e+'"]').html(addCompare_item).attr("data-sku","")}function addToCompare(e){let t=jQuery(e),a=void 0!==is_comparePage&&is_comparePage,o=t.closest(".product-data").data("name"),n=t.closest(".product-data").data("sku"),i=t.closest(".product-data").data("image"),s=t.closest(".product-data").data("url"),r=JSON.parse(localStorage.getItem("compareList"))||[];r.length>=3?siteNotify(translations.max_compare):(r.length<3&&!r.some(e=>e.sku===n)?(r.push({name:o,sku:n,image_url:i,url:s}),localStorage.setItem("compareList",JSON.stringify(r)),updateCompareListUI(r),showCompare()):siteNotify(translations.added_compare),a&&window.location.reload())}function removeCompare(e){console.log("remove",e);let t=JSON.parse(localStorage.getItem("compareList"))||[];t=t.filter(t=>String(t.sku)!==String(e)),localStorage.setItem("compareList",JSON.stringify(t)),updateCompareListUI(t)}function updateCompareListUI(e,t=!1){let a=jQuery("#compare-list .listcompare");a.empty(),e.forEach(e=>{let t=`<li><a href="${e.url}" class=""><img src="${e.image_url}" alt=""><h3>${e.name}</h3></a><span class="remove-ic-compare" onclick="removeCompare('${e.sku}');"><i class="bi bi-x-lg"></i></span></li>`;a.append(t)});for(let t=e.length;t<3;t++)a.append(`\n      <li class="formsg">\n        <a href="#" class="cp-plus cp-plus_new"  data-bs-toggle="modal" data-bs-target="#searchProduct_modal">\n          <i class="bi bi-plus-lg"></i><p>${translations.add_product}</p>\n        </a>\n      </li>\n    `);let o=jQuery("#compare-list .closecompare .btn");e.length>0?(o.prop("disabled",!1),jQuery("#gotoCompare").attr("href",generateCompareUrl(e)),jQuery("#compare-popup-btn #count-compare-item").text("("+e.length+")")):(o.prop("disabled",!0),jQuery("#compare-list").fadeOut(),jQuery("#compare-popup-btn #count-compare-item").text("")),t&&e.length>0&&hideCompare(),updateCompareButtonStatus()}function RemoveAllIdCompare(){localStorage.removeItem("compareList"),updateCompareListUI([])}function generateCompareUrl(e){if(!e||0===e.length)return"#";let t=[];return e.forEach(e=>{t.push(`${createSlug(e.name)}.${e.sku}`)}),window.location.origin+["/so-sanh/"].join("")+t.join(";")}function siteNotify(e){jQuery("#siteNotify .toast-body").text(e),new bootstrap.Toast(jQuery("#siteNotify")[0]).show()}function isProductInCompareList(e){return(JSON.parse(localStorage.getItem("compareList"))||[]).some(t=>t.sku===e)}function updateCompareButtonStatus(){JSON.parse(localStorage.getItem("compareList"));jQuery(document).find(".compare-btn").each(function(){let e=jQuery(this);isProductInCompareList(e.closest(".product-data").data("sku"))?e.html(`<i class="bi bi-check2-circle"></i> ${translations.added}`):e.html(`<i class="bi bi-plus-circle"></i> ${translations.compare}`)})}function createSlug(e){if(!e)return"";let t=e.toLowerCase();return t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),t=t.replace(/[^a-z0-9]+/g,"-"),t=t.replace(/^-+|-+$/g,""),t}