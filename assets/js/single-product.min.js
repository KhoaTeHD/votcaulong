jQuery(document).ready(function(t){const i=t(".single-product");if(i.length){!function(t){let i=JSON.parse(localStorage.getItem("viewedProducts"))||[];i=i.filter(i=>i.id!==t.id),i.unshift(t),i.length>10&&(i=i.slice(0,10));localStorage.setItem("viewedProducts",JSON.stringify(i))}({id:i.data("id"),sku:i.data("sku"),name:i.data("name").trim(),price:i.data("price-html"),originalPrice:i.data("original-price"),saleOff:i.data("saleoff"),image:i.data("image"),category:i.data("category"),url:i.data("url")})}t(".addToCart-box .qty-plus-old").on("click",function(){const i=t(this).siblings(".item-qty");let e=parseInt(i.val());i.val(e+1)}),t(".addToCart-box #addToCart, .addToCart-box #quickBuy, .addToCart-box #muaTraGop").on("click",function(e){e.preventDefault();const a=t(this),o=a.attr("id"),n="quickBuy"===o,r="muaTraGop"===o,s=a.data("checkout");if("in-stock"!==i.data("status"))return void siteNotify(translations.cart_out_stock);let c=parseInt(t(".addToCart-box #quantity").val(),10);(!Number.isFinite(c)||c<1)&&(c=1);const l={id:i.data("id"),sku:i.data("sku"),name:(i.data("name")||"").trim(),price:i.data("price"),originalPrice:i.data("original-price")||0,saleOff:i.data("saleoff")||0,image:i.data("image")||"",category:i.data("category")||"",url:i.data("url")||"",attributes:i.data("attributes")||null,variation:i.data("variation")||null,quantity:c,selected:i.data("selected")||""};if(l.id&&l.price&&l.selected)if(addToCart(l),(n||r)&&"string"==typeof s&&""!==s.trim())window.location.assign(s);else{const t=document.getElementById("shoppingCartCanvas");if(t){bootstrap.Offcanvas.getOrCreateInstance(t).show()}}else siteNotify(translations.cart_invalid_product)});var e,a=!1;t(".lightbox-swiper .swiper-slide").length;var o;new Swiper(".thumbnail-navigation.swiper-container",{slidesPerView:3,spaceBetween:10,navigation:{nextEl:".thumbnail-navigation .swiper-button-next",prevEl:".thumbnail-navigation .swiper-button-prev"}});t(".thumbnail-item").on("click",function(){var i=t(this).attr("data-image");t("#main-product-image").attr("src",i),t(".zoomed-image").attr("src",i),t(".thumbnail-item").removeClass("active"),t(this).addClass("active")}),t(".lightbox-swiper .swiper-button-next, .lightbox-swiper .swiper-button-prev").on("click",function(t){t.stopPropagation()}),o=new Swiper(".lightbox-thumbs",{spaceBetween:10,slidesPerView:4,freeMode:!0,watchSlidesProgress:!0,navigation:{nextEl:".lightbox-thumbs .swiper-button-next",prevEl:".lightbox-thumbs .swiper-button-prev"}}),a||(e=new Swiper(".lightbox-swiper",{loop:!1,navigation:{nextEl:".lightbox-swiper .swiper-button-next",prevEl:".lightbox-swiper .swiper-button-prev"},thumbs:{swiper:o}}),a=!0,e.on("slideChange",function(){o.slideTo(e.activeIndex)}));let n=t(".main-image"),r=t(".zoom-lens"),s=t(".zoom-result"),c=t(".zoomed-image"),l=t("#main-product-image").width(),d=t("#main-product-image").height(),u=(s.width(),s.height(),c.width()/l);n.on("mousemove",function(t){let i=this.getBoundingClientRect(),e=t.clientX-i.left,a=t.clientY-i.top,o=e-r.width()/2,n=a-r.height()/2;o=Math.max(0,Math.min(l-r.width(),o)),n=Math.max(0,Math.min(d-r.height(),n)),r.css({left:o,top:n,display:"block"}),s.css({display:"block"}),c.css({transform:`translate(-${o*u}px, -${n*u}px)`})}),n.on("mouseleave",function(){r.hide(),s.hide()}),t(".main-image").on("click",function(){var i;t(this).find("#main-product-image").attr("src")||t(this).attr("data-image");t(this).hasClass("thumbnail-item")?i=t(this).closest(".swiper-slide").index():i=t(".thumbnail-item.active").closest(".swiper-slide").index();e.slideTo(i),t("#lightbox").modal("show")}),t("#view-video-btn").on("click",function(i){i.preventDefault();var e=t(this).attr("data-video");if(!e)return;let a=!1;if(e.includes("tiktok.com")&&(a=!0),console.log(e),a){var o=`<blockquote class="tiktok-embed" cite="${e}" data-video-id="${function(t){const i=/\/video\/(\d+)/,e=t.match(i);if(e&&e[1])return e[1];return null}(e)}" style="max-width: 605px;min-width: 325px;" > <section>  </section> </blockquote> <script async src="https://www.tiktok.com/embed.js"><\/script>`;t("#video360-lightbox .modal-body").html(o)}else{var n=function(t){let i=null,e=t.match(/(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return e&&e[1]&&(i=e[1]),e=t.match(/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/),e&&e[1]&&(i=e[1]),i||(e=t.match(/youtube\.com\/.*[?&]v=([a-zA-Z0-9_-]{11})/),e&&e[1]&&(i=e[1])),i?`https://www.youtube.com/embed/${i}`:t}(e),r="ratio-16x9";/youtube\.com\/shorts\//.test(e)?(t("#video360-lightbox").addClass("video-modal"),r="ratio-9x16"):t("#video360-lightbox").removeClass("video-modal"),t("#video360-lightbox .modal-body").html(`\n                <div class="${r}">\n                    <iframe src="${n}" frameborder="0" allowfullscreen class="lightbox-video" \n                    style=""></iframe>\n                </div>\n            `)}t("#video360-lightbox").modal("show")}),t("#360-button").on("click",function(i){if(i.preventDefault(),t("#360-button").data("image360").length){let i='<div id="product-360" >\n                        <img id="product-image-360" src="" class="img-fluid lightbox-360"alt="Product 360 View">\n                    </div>';t("#video360-lightbox .modal-body").html(i),b(),t("#video360-lightbox").modal("show")}}),t("#lightbox").on("click",function(i){i.target,t("#lightbox-image")[0]}),t("#lightbox").on("hidden.bs.modal",function(){t(".lightbox-video").attr("src","")});var m="#product-image-360",h=t("#360-button").data("image360"),g=0,p=0;if(h.length>0){function b(){t(document).find(m).attr("src",h[g])}for(var f=0;f<h.length;f++)(new Image).src=h[f];t(document).on("mousemove","#product-360",function(t){var i=t.pageX-p;Math.abs(i)>35&&((g-=Math.round(i/35))<0?g=h.length-1:g>=h.length&&(g=0),b(),p=t.pageX)})}const v=t(".product-variations");function w(i){const e=Object.values(window.productVariants)[0];Object.keys(e.attributes).length;v.find(".variation-group").each(function(){const e=t(this),a=e.find(".variation-options").data("attribute");i[a]||e.find(".variation-option").each(function(){const e=t(this),o=e.data("name");e.removeClass("disabled");const n={...i,[a]:o};let r=!1;for(const t of Object.values(window.productVariants)){let i=!0;for(const e in n)if(!t.attributes.hasOwnProperty(e)||String(t.attributes[e]).toLowerCase().trim()!==String(n[e]).toLowerCase().trim()){i=!1;break}if(i&&parseInt(t.stock,10)>0){r=!0;break}}r||e.addClass("disabled").removeClass("active")})})}function k(){const i={};return t(".variation-group",v).each(function(){const e=t(this).find(".variation-options").data("attribute"),a=t(this).find(".variation-option.active");a.length>0&&(i[e]=a.data("name"))}),i}v.on("click",".variation-option",function(){const e=t(this);if(e.hasClass("active")){e.removeClass("active");return w(k()),void i.data("price",0)}const a=e.closest(".variation-group"),o=e.data("variant-sku")??null;if(o){const i=window.BranchStock[o];if(i){const e=Object.entries(i).filter(([t,i])=>i.stock>0).map(([t,i])=>({name:t,stock:i.stock,url:i.url}));let a="";e.length&&e.forEach(t=>{let i="#",e=window.branches_data[t.name]??null;e&&e.url&&(i=e.url,name=e.name),a+=`<li>\n                            <a href="${i}" target="_blank" role="button">${name}</a> \n                            <span class="store-stock">${t.stock} ${translations.products_left}</span>\n                        </li>`}),t(".product-store").html(a)}else t(".product-store").html("<li>"+translations.branch_not_found+"</li>")}if(e.hasClass("disabled"))return;a.find(".variation-option").removeClass("active"),e.addClass("active");const n=e.find("img").attr("src");n&&(t("#main-product-image").attr("src",n),t(".zoomed-image").attr("src",n));const r=k(),s=Object.keys(r).length===t(".variation-group",v).length;if(w(r),!s||Object.keys(r).length<v.find(".variation-group").length)return void i.data("price",0);const c=function(t){for(const[i,e]of Object.entries(window.productVariants)){const i=e.attributes||{},a=Object.keys(t).sort(),o=Object.keys(i).sort();if(a.length!==o.length)continue;let n=!0;for(let e=0;e<a.length;e++){const r=a[e],s=String(t[r]||"").toLowerCase().trim(),c=String(i[r]||"").toLowerCase().trim();if(r!==o[e]||s!==c){n=!1;break}}if(n)return e}return null}(r);c?function(e){const{price_formatted:a,price:o,original_price_formatted:n,original_price:r,image_url:s,sku:c,stock:l,price_html:d,attributes:u}=e;t(".price").html(d),s&&(t("#main-product-image").attr("src",s),t(".zoomed-image").attr("src",s)),l&&i.data({id:c,price:o,attributes:u,image:s,variation:{sku:c,id:c},selected:c})}(c):t(".product-stock").text(translation.not_available)})});